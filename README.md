# Инструкция по запуску
В каждой из папок расположены 3 файла, каждый из файлов отвечает за определенный этап парсинга / обработки информации. Файлы необходимо запускать в том порядке, в каком они расположены в папке - сначала 1_, затем 2_, затем 3_.

### Для работы кода необходимы:
- Установленный `Chrome` последней версии
- Установка всех необходимых библиотек путем запуска команды `pip install -r requirements.txt` в директории проекта 

# Описание работы файлов

## `oriental`
### `1_urls.py`
Этот скрипт использует библиотеку selenium для автоматизации веб-серфинга и сбора информации о продуктах с сайта https://www.orental.ru/perfume/. Скрипт создает таблицу products в базе данных SQLite с именем products.db и сохраняет идентификатор продукта и ссылку для каждого продукта, найденного на сайте.

Скрипт использует цикл while для перебора страниц сайта, начиная с 1-й страницы. На каждой странице он ожидает появления всех элементов с именем класса prod-teas__head, используя WebDriverWait и expected_conditions. Эти элементы представляют собой ссылки на отдельные страницы продуктов.

Если на странице не найдено ссылок на продукты, цикл прерывается и скрипт завершается. В противном случае, для каждой найденной ссылки на продукт скрипт генерирует уникальный идентификатор, добавляя число к базовому значению 10000. Идентификатор и ссылка на продукт затем вставляются в таблицу products в базе данных SQLite.

После обработки всех ссылок на продукты на странице скрипт увеличивает номер страницы и переходит к следующей странице. Когда цикл заканчивается, скрипт закрывает соединение с базой данных и выходит из драйвера.
### `2_items.py`
Этот скрипт использует библиотеки selenium и selenium-stealth для автоматизации веб-серфинга и сбора информации о продуктах с сайта https://www.orental.ru/perfume/. Скрипт создает таблицу items в базе данных SQLite с именем orental.db и сохраняет различную информацию о каждом продукте, найденном на сайте, такую как его артикул, название, цена, бренд, объем, URL-адрес изображения и многое другое.

Скрипт определяет несколько функций, включая db_start() и get_data(). Функция db_start() инициализирует соединение с базой данных SQLite и создает таблицу items, если она еще не существует. Функция get_data() принимает в качестве входных данных артикул, URL-адрес и список прокси. Она использует библиотеку undetected-chromedriver для создания экземпляра драйвера Chrome с случайным прокси из предоставленного списка. Функция затем использует драйвер для перехода по указанному URL-адресу и сбора информации о продукте со страницы.

Скрипт использует различные техники для избежания обнаружения при сборе информации, такие как использование случайного агента пользователя и применение настроек скрытности к драйверу с помощью библиотеки selenium-stealth. Он также использует WebDriverWait и expected_conditions для ожидания загрузки элементов страницы перед попыткой взаимодействия с ними.

После того, как информация о продукте была собрана, скрипт вставляет ее в таблицу items в базе данных SQLite. Скрипт также использует библиотеку multiprocessing для параллелизации процесса сбора информации путем асинхронного применения функции get_data() к нескольким артикулам и URL-адресам с использованием пула процессов.
### `3_transfer.ipynb`
Этот скрипт использует библиотеки `pandas` и `sqlite3` для работы с базой данных SQLite с именем `oriental.db`. Скрипт извлекает все данные из таблицы `items` в базе данных и сохраняет их в объекте DataFrame библиотеки `pandas`.

Скрипт определяет несколько функций, включая `calculate_string()` и `get_dimensions()`. Функция `calculate_string()` принимает строку в качестве входных данных и вычисляет результат математического выражения, содержащегося в этой строке. Функция используется для вычисления объема продукта на основе строки, содержащей информацию об объеме. Функция `get_dimensions()` принимает объем продукта в качестве входных данных и возвращает кортеж из четырех элементов, представляющих вес, длину, ширину и высоту продукта.

Скрипт применяет эти функции к столбцам DataFrame, чтобы вычислить объем и размеры каждого продукта. Скрипт также выполняет ряд других операций над данными, таких как удаление строк, содержащих определенные значения, замена значений в определенных столбцах и фильтрация строк на основе условий.

Наконец, скрипт группирует данные по столбцу `commerce_type` и сохраняет каждую группу в отдельный файл Excel с соответствующим именем.

## `aroma-butik`
### `1_urls.py`
Этот код использует библиотеки `requests`, `pandas` и `sqlite3`. Он также импортирует модуль `time` для работы с временем.

Код содержит три функции: `compare_strings(s1, s2)`, `add_to_database(compare_result, data)` и `add_error_to_database(error_message, url, query)`.

- `compare_strings(s1, s2)`: Эта функция принимает две строки в качестве аргументов и сравнивает их. Она разбивает строки на отдельные слова, используя пробелы в качестве разделителей, и создает два объекта Series библиотеки `pandas`. Функция затем подсчитывает количество слов в более короткой серии, которые также присутствуют в более длинной серии. Если это количество равно длине более короткой серии, функция возвращает 1. Если это количество больше или равно 1, но меньше длины более короткой серии, функция возвращает 2. В противном случае функция возвращает 0.

- `add_to_database(compare_result, data)`: Эта функция принимает два аргумента: результат сравнения строк и данные для добавления в базу данных. Она создает соединение с базой данных SQLite и создает три таблицы: `correct_table`, `check_table` и `incorrect_table`. Каждая таблица содержит столбцы для хранения информации об элементах, таких как `art`, `query`, `link_url`, `brand` и `name`. Функция затем добавляет данные в одну из таблиц в зависимости от значения аргумента `compare_result`.

- `add_error_to_database(error_message, url, query)`: Эта функция принимает три аргумента: сообщение об ошибке, URL-адрес запроса и фразу для поиска. Она создает соединение с базой данных SQLite и создает таблицу `error_table`, которая содержит столбцы для хранения информации об ошибках, таких как `error_message`, `url` и `query`. Функция затем добавляет данные об ошибке в таблицу.

Код также создает соединение с другой базой данных SQLite и извлекает данные из таблицы `check_table`. Он затем проходит по этим данным в цикле for и выполняет запросы к API RetailRocket, используя значения в столбце `query` как фразы для поиска. Код получает ответ от API в формате JSON и проверяет соответствие между значением в столбце `query` и информацией о продукте из ответа API, используя функцию `compare_strings`. Если значения соответствуют, код вызывает функцию `add_to_database` для добавления данных об элементе в базу данных.
### `2_items.py`
- Код определяет функцию с именем `get_data(art, url)`, которая принимает два аргумента: значение art и URL. Функция создает соединение с базой данных SQLite и использует Selenium WebDriver для перехода на указанный URL. Затем она ожидает загрузки определенных элементов на странице и извлекает информацию из них, такую как бренд, страну и пол продукта. Функция также проверяет, находится ли бренд в списке определенных брендов, и возвращает 0, если это так. Функция затем перебирает список элементов на странице и извлекает информацию, такую как объем, URL-адрес изображения, цена и тип коммерции продукта. Она также генерирует значения для других переменных, таких как тип элемента, имя элемента, prev_price, nds, вес, длина, ширина, высота, add_together, целевая аудитория, состав, класс опасности, срок годности и okpd_code.

- Код содержит список строковых значений, представляющих названия стран. Он обновляет значения в столбце `country` DataFrame `out_df`, заменяя значения, которые не присутствуют в списке стран, пустой строкой. Код также содержит функцию `replace_ml(text)`, которая принимает строку в качестве аргумента и заменяет все вхождения подстроки вида "Xмл" (где X - число) на подстроку вида "X мл" (с пробелом между числом и "мл"). Функция использует регулярные выражения для выполнения замены. Код применяет функцию `replace_ml` ко всем строковым значениям в DataFrame `out_df` и обновляет значения в столбце `item_type`, устанавливая их равными "Духи". Код также содержит путь к файлу Excel и сохраняет DataFrame `out_df` в этот файл, сортируя строки по значению в столбце `add_together`.

- Код определяет функцию с именем `get_data(art, url)`, которая принимает два аргумента: значение art и URL. Функция создает соединение с базой данных SQLite и использует Selenium WebDriver для перехода на указанный URL. Затем она ожидает загрузки определенных элементов на странице и извлекает информацию из них, такую как бренд, страну и пол продукта. Функция также проверяет, находится ли бренд в списке определенных брендов, и возвращает 0, если это так. Функция затем перебирает список элементов на странице и извлекает информацию, такую как объем, URL-адрес изображения, цена и тип коммерции продукта. Она также генерирует значения для других переменных, таких как тип элемента, имя элемента, prev_price, nds, вес, длина, ширина, высота, add_together, целевая аудитория, состав, класс опасности, срок годности и okpd_code.

Когда скрипт запускается как основная программа, он вызывает функцию `db_start` для создания соединения с базой данных и создания таблицы, если она еще не существует. Затем он извлекает список URL-адресов из базы данных и использует класс Pool из модуля multiprocessing для асинхронного применения функции `get_data` к каждому URL-адресу.
### `3_transfer.ipynb`
Этот скрипт использует библиотеки `pandas` и `sqlite3` для работы с базой данных SQLite с именем `aroma.db`. Скрипт извлекает все данные из таблицы `items` в базе данных и сохраняет их в объекте DataFrame библиотеки `pandas`.

Скрипт определяет несколько функций, включая `calculate_string()` и `get_dimensions()`. Функция `calculate_string()` принимает строку в качестве входных данных и вычисляет результат математического выражения, содержащегося в этой строке. Функция используется для вычисления объема продукта на основе строки, содержащей информацию об объеме. Функция `get_dimensions()` принимает объем продукта в качестве входных данных и возвращает кортеж из четырех элементов, представляющих вес, длину, ширину и высоту продукта.

Скрипт применяет эти функции к столбцам DataFrame, чтобы вычислить объем и размеры каждого продукта. Скрипт также выполняет ряд других операций над данными, таких как удаление строк, содержащих определенные значения, замена значений в определенных столбцах и фильтрация строк на основе условий.

Наконец, скрипт группирует данные по столбцу `commerce_type` и сохраняет каждую группу в отдельный файл Excel с соответствующим именем.

## `randewoo`
### `1_urls.py`
Этот код выполняет поиск продуктов на сайте Diginetica с использованием их API. Он загружает список поисковых запросов из базы данных SQLite, затем для каждого запроса выполняет GET-запрос к API Diginetica и обрабатывает ответ.

Функция `compare_strings` сравнивает две строки и возвращает результат сравнения: 1, если все слова из короткой строки присутствуют в длинной строке; 2, если хотя бы одно слово из короткой строки присутствует в длинной строке; 0, если ни одно слово из короткой строки не присутствует в длинной строке.

Функция `add_to_database` добавляет данные о продукте в базу данных SQLite в соответствующую таблицу в зависимости от результата сравнения.

Функция `add_error_to_database` добавляет информацию об ошибке в таблицу `error_table` в базе данных SQLite.

В основном цикле кода для каждого поискового запроса выполняется GET-запрос к API Diginetica, затем обрабатывается ответ и вызывается функция `compare_strings` для сравнения поискового запроса с именем и брендом первого продукта из ответа. Если результат сравнения не равен `None`, вызывается функция `add_to_database` для добавления данных о продукте в базу данных.
### `2_items.py`
Этот код использует несколько библиотек Python, таких как `sqlite3`, `selenium`, `undetected_chromedriver`, `re`, `itertools`, `time`, `numpy`, `multiprocessing`, `tqdm` и `fake_useragent`. Он также устанавливает опции для драйвера Chrome и использует функцию `stealth` из библиотеки `selenium_stealth`.

Код содержит три основные функции: `db_start()`, `get_dimensions(volume)` и `get_data(art, url)`.

- `db_start()`: Эта функция создает соединение с базой данных SQLite и создает таблицу с именем `items_data`, если она еще не существует. Таблица содержит столбцы для хранения информации об элементах, таких как `art`, `search_name`, `item_name`, `price`, `prev_price`, `nds`, `commerce_type`, `weight`, `width`, `height`, `length`, `image_url`, `item_type`, `model_name`, `brand`, `sex`, `add_together`, `volume`, `country`,` target_audience`,` composition`,` danger_class`,` expiration_date`,` okpd_code` и` annotation`.

- `get_dimensions(volume)`: Эта функция принимает в качестве аргумента объем и возвращает кортеж из четырех элементов: вес, длина, ширина и высота. Значения этих переменных зависят от значения объема.

- `get_data(art, url)`: Эта функция принимает в качестве аргументов значение art и URL-адрес. Она создает соединение с базой данных SQLite, использует драйвер Chrome для перехода по указанному URL-адресу и извлекает информацию о продукте с этой страницы. Функция пытается получить информацию о бренде, имени, поле, стране и изображении продукта. Она также пытается получить информацию о объеме, цене и типе продукта. Функция проверяет, соответствует ли объем продукта определенным критериям и пропускает продукты с определенными характеристиками. Затем функция создает строку поиска и имя элемента, используя информацию о бренде, имени и объеме продукта. Она также вычисляет предыдущую цену, используя текущую цену и случайное значение. Функция также получает значения веса, длины, ширины и высоты, вызывая функцию` get_dimensions` с аргументом объема. Затем функция устанавливает значения для различных переменных, таких как` model_name`,` brand`,` volume`,` add_together`,` target_audience`,` composition`,` danger_class`,` expiration_date` и` okpd_code`. Наконец, функция извлекает текст аннотации со страницы и добавляет запись в таблицу базы данных с информацией о продукте.
### `3_transfer.ipynb`
Код содержит две функции: `compare_strings_url(s1, s2)` и `fill_img_url(row)`.
- Функция `compare_strings_url(s1, s2)` принимает две строки в качестве аргументов и сравнивает их. Она разбивает строки на отдельные слова, используя запятые и пробелы в качестве разделителей, и создает два объекта Series библиотеки `pandas`. Функция затем подсчитывает количество слов в более короткой серии, которые также присутствуют в более длинной серии. Если это количество равно или больше длины более короткой серии, функция возвращает 1, в противном случае - 0.
- Функция `fill_img_url(row)` принимает строку DataFrame в качестве аргумента. Если значение в столбце `image_url` этой строки является null, функция создает запрос к API RetailRocket, используя значение в столбце `item_name` как фразу для поиска. Функция затем получает ответ от API в формате JSON и проверяет соответствие между значением в столбце `item_name` и информацией о продукте из ответа API, используя функцию `compare_strings_url`. Если значения соответствуют, функция возвращает URL-адрес изображения продукта из ответа API. В противном случае она возвращает исходное значение в столбце `image_url`. Если значение в столбце `image_url` не является null, функция просто возвращает его. так же содержит несколько списков строковых значений, которые используются для обновления значений в DataFrame. Он выполняет ряд операций по изменению значений в DataFrame, таких как замена значений в столбце `brand`, удаление строк с определенными значениями и замена определенных строковых значений.
- Код также выполняет ряд операций по изменению структуры DataFrame, таких как добавление новых столбцов, удаление существующих столбцов и изменение порядка столбцов. Он также сортирует строки DataFrame по значению в столбце `image_url`, удаляет дубликаты строк по значениям в определенных столбцах и фильтрует строки по значениям в столбце `volume`. Так же содержит список строковых значений, представляющих названия стран. Он обновляет значения в столбце `country` DataFrame `out_df`, заменяя значения, которые не присутствуют в списке стран, пустой строкой. Код также содержит функцию `replace_ml(text)`, которая принимает строку в качестве аргумента и заменяет все вхождения подстроки вида "Xмл" (где X - число) на подстроку вида "X мл" (с пробелом между числом и "мл"). Функция использует регулярные выражения для выполнения замены. Код применяет функцию `replace_ml` ко всем строковым значениям в DataFrame `out_df` и обновляет значения в столбце `item_type`, устанавливая их равными "Духи". Код также содержит путь к файлу Excel и сохраняет DataFrame `out_df` в этот файл, сортируя строки по значению в столбце `add_together`.
